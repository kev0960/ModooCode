(()=>{var t={778:()=>{window.onGoogleLogin=function(t){fetch("/auth/goog",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({token:t.credential})}).then((function(t){console.log(t),location.reload()}))}}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,n),i.exports}(()=>{"use strict";var t=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))},e=function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},o=function(){function n(){this.last_comment_index_=0,this.comments_=new Map,this.root_comments_=[],this.num_total_comments_=getNumTotalComments()}return n.prototype.LoadComments=function(){return t(this,void 0,void 0,(function(){var t,n,o,r,i,a,c;return e(this,(function(e){switch(e.label){case 0:return t=window.location.pathname,n=t.substr(t.lastIndexOf("/")+1),[4,fetch("/get-comment",{method:"POST",mode:"cors",cache:"no-cache",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({article_url:n,index_start:this.last_comment_index_})})];case 1:return[4,e.sent().json()];case 2:for(o=e.sent(),r=o.comments,i=0,a=r;i<a.length;i++)c=a[i],this.comments_.set(c.comment_id,c);return this.last_comment_index_+=50,[2]}}))}))},n.prototype.PostComment=function(n,o,r,i){return t(this,void 0,void 0,(function(){var t,a;return e(this,(function(e){return t=window.location.href,a=t.substr(t.lastIndexOf("/")+1),document.getElementById("posted-comment"),grecaptcha.ready((function(){grecaptcha.execute("6LeE_nYUAAAAAGm9qTa71IwvvayWV9Q7flqNkto2",{action:"Comment"}).then((function(t){fetch("/write-comment",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({parent_id:n,content:o,password:r||"",author_name:i,article_url:a,captcha_token:t})}).then((function(t){console.log(t),document.getElementById("adding-comment").hidden=!0,location.reload()}))}))})),[2]}))}))},n.prototype.ComputeRootComments=function(){var t=Array.from(this.comments_.keys()).sort((function(t,e){return t-e})),e=new Set;this.root_comments_=[];for(var n=0,o=t;n<o.length;n++){var r=o[n];e.has(r)||(this.root_comments_.push(this.comments_.get(r)),this.VisitAllChildComments(r,e))}this.root_comments_=this.root_comments_.reverse()},n.prototype.VisitAllChildComments=function(t,e){var n=this.comments_.get(t);if(n){e.add(t);for(var o=0,r=n.reply_ids||[];o<r.length;o++){var i=r[o];this.VisitAllChildComments(i,e)}}},n.prototype.CreateCommentList=function(){var t=document.createElement("ul");t.classList.add("comment-list"),t.id="root-comment-list";for(var e=0,n=this.root_comments_;e<n.length;e++)for(var o=n[e],r=0,i=this.CreateComment(o.comment_id);r<i.length;r++){var a=i[r];t.appendChild(a)}return t},n.prototype.CreateComment=function(t){var e,n=this.comments_.get(t);if(n){var o=document.createElement("li");o.classList.add("comment");var r=document.createElement("div");r.classList.add("comment-profile");var i=document.createElement("img");n.image_link?(i.src=n.image_link,i.alt="프로필 사진"):(i.src="./img/unknown_person.png",i.alt="프로필 사진 없음"),r.appendChild(i),o.appendChild(r);var a=document.createElement("div");a.classList.add("comment-info");var c=document.createElement("div");c.classList.add("comment-header");var s=function(t,e){var n=document.createElement("span");return n.classList.add(t),n.textContent=e,n};c.appendChild(s("comment-author",n.author_name||"")),c.appendChild(s("comment-date",n.comment_date||"")),a.appendChild(c);var l=document.createElement("div");l.classList.add("comment-content"),l.textContent=n.content,a.appendChild(l);var d=document.createElement("div");if(d.classList.add("comment-action"),d.id="comment-id-"+t,d.appendChild(s("comment-upvote","추천")),d.appendChild(s("comment-reply","답글")),d.appendChild(s("comment-delete","답글 삭제")),a.appendChild(d),o.appendChild(a),!(null===(e=n.reply_ids)||void 0===e?void 0:e.length))return[o];var h=document.createElement("ul");h.classList.add("comment-list");for(var u=0,m=n.reply_ids;u<m.length;u++)for(var p=m[u],_=0,f=this.CreateComment(p);_<f.length;_++){var v=f[_];h.append(v)}return[o,h]}},n.prototype.GetNumTotalComments=function(){return this.num_total_comments_},n.prototype.GetLastCommentIndex=function(){return this.last_comment_index_},n}(),r=function(){function t(){this.last_position=window.scrollY,this.time_to_update_toc=!0,this.scroll_down_event_handlers=[],this.scroll_up_event_handlers=[],this.InstallScrollEventHandler()}return t.prototype.InstallScrollEventHandler=function(){var t=this;window.addEventListener("scroll",(function(e){t.time_to_update_toc&&(window.requestAnimationFrame((function(){if(t.time_to_update_toc=!0,t.last_position>window.scrollY)for(var e=0,n=t.scroll_up_event_handlers;e<n.length;e++)(0,n[e])();else for(var o=0,r=t.scroll_down_event_handlers;o<r.length;o++)(0,r[o])();t.last_position=window.scrollY})),t.time_to_update_toc=!1)}))},t.prototype.RegisterScrollUpHandler=function(t){this.scroll_up_event_handlers.push(t)},t.prototype.RegisterScrollDownHandler=function(t){this.scroll_down_event_handlers.push(t)},t}();function i(t){for(var e=0;e<t.length&&" "==t[e];e++);return t.substring(e)}var a=function(){function t(){this.toc_headers_=[],this.time_to_update_toc=!0,this.prev_highlighted=0,this.FetchHeaders()}return t.prototype.FetchHeaders=function(){for(var t,e=0,n=document.querySelectorAll(".header-general");e<n.length;e++){var o=n[e],r=i(o.innerText),a="h"!=(t=o.tagName)[0]&&"H"!=t[0]?-1:parseInt(t.substring(1)),c=o.id,s=o.getBoundingClientRect().top+window.scrollY;this.toc_headers_.push({header_name:r,header_tag:a,header_id:c,header_pos:s,header_elem_link:null})}},t.prototype.RecursiveTOCCreator=function(t,e,n){for(var o=null,r=e;r<this.toc_headers_.length;r++){var i=this.toc_headers_[r];if(i.header_tag<n)return r;if(i.header_tag>n){var a=document.createElement("ol");a.className="toc-list",o.appendChild(a),r=this.RecursiveTOCCreator(a,r,i.header_tag),r--}else{var s=c(i);i.header_elem_link=s.firstChild,t.appendChild(s),o=s}}return r},t.prototype.CreateTOCList=function(){var t=document.querySelector(".toc-list");null!=t&&(this.RecursiveTOCCreator(t,0,this.toc_headers_[0].header_tag),this.InstallTOCEventHandlers())},t.prototype.InstallTOCEventHandlers=function(){var t=this;window.addEventListener("scroll",(function(){var e=window.scrollY;t.time_to_update_toc&&(window.requestAnimationFrame((function(){t.time_to_update_toc=!0;var n=t.GetCurrentActiveTOCItem(e);t.HighlightActiveItem(n)})),t.time_to_update_toc=!1)}))},t.prototype.HighlightActiveItem=function(t){this.toc_headers_[this.prev_highlighted].header_elem_link.className="toc-item-link",this.toc_headers_[t].header_elem_link.className="toc-item-link toc-active-item",this.prev_highlighted=t},t.prototype.InstallLinkClickHandler=function(){for(var t=function(t){t.header_elem_link.onclick=function(e){window.scrollTo(0,t.header_pos-150),console.log(t.header_pos-150)}},e=0,n=this.toc_headers_;e<n.length;e++)t(n[e])},t.prototype.GetCurrentActiveTOCItem=function(t){if(t<this.toc_headers_[0].header_pos)return 0;for(var e,n=0;n<this.toc_headers_.length&&n!=this.toc_headers_.length-1;n++)if(this.toc_headers_[n].header_pos<=t&&t<this.toc_headers_[n+1].header_pos)return t-this.toc_headers_[n].header_pos>this.toc_headers_[n+1].header_pos-t&&(void 0,(e=this.toc_headers_[n+1].header_elem_link.getBoundingClientRect()).top>=0&&e.left>=0&&e.right<=(window.innerWidth||document.documentElement.clientWidth)&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight))?n+1:n;return n},t}();function c(t){var e=document.createElement("li");e.className="toc-list-item";var n=document.createElement("span");return n.className="toc-item-link",n.textContent=t.header_name,e.appendChild(n),e}n(778);function s(){return t=this,e=void 0,i=function(){var t;return function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return(n=new a).CreateTOCList(),n.InstallLinkClickHandler(),(new r).RegisterScrollUpHandler((function(){})),[4,(t=new o).LoadComments()];case 1:return e.sent(),t.ComputeRootComments(),console.log("html ",t.CreateCommentList()),t.GetNumTotalComments()>=t.GetLastCommentIndex()&&(console.log("not hidden"),document.getElementById("button-box").hidden=!1),[2]}var n}))},new((n=void 0)||(n=Promise))((function(o,r){function a(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((i=i.apply(t,e||[])).next())}));var t,e,n,i}window.onload=function(){s()}})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUswQixFQUFTQyxNQUFRLEdBQ3pDRCxFQUFTRSxRQUNSdkssT0FBT3dLLFlBQWNsSCxTQUFTbUgsZ0JBQWdCQyxjQUMvQ0wsRUFBU00sU0FDUjNLLE9BQU80SyxhQUFldEgsU0FBU21ILGdCQUFnQkksZUNzR3JDakQsRUFBSSxFQUVKQSxFQUliLE9BQU9BLENBQ1QsRUFLRixFQWxJQSxHQW9JQSxTQUFTeUIsRUFBeUJuQixHQUNoQyxJQUFJa0IsRUFBVTlGLFNBQVM4QixjQUFjLE1BQ3JDZ0UsRUFBUUQsVUFBWSxnQkFFcEIsSUFBSTJCLEVBQU94SCxTQUFTOEIsY0FBYyxRQUtsQyxPQUpBMEYsRUFBSzNCLFVBQVksZ0JBQ2pCMkIsRUFBSzFFLFlBQWM4QixFQUFPQyxZQUUxQmlCLEVBQVEzRCxZQUFZcUYsR0FDYjFCLENBQ1QsQyxPQ2xKQSxTQUFlMkIsSSxvcENBaUJiLE9Eb0lJQyxFQUFNLElBQUlDLEdBQ1YxQixnQkFHSnlCLEVBQUlmLDJCRjdHUyxJQUFJaUIsR0d4Q1YxRCx5QkFBd0IsV0FVL0IsSUFHQSxJQURJMkQsRUp1TlUsSUFBSUMsR0l0TkluSixnQixjQUF0QixTQUVBa0osRUFBZ0JuSCxzQkFDaEJsRCxRQUFRQyxJQUFJLFFBQVNvSyxFQUFnQmpHLHFCQUduQ2lHLEVBQWdCdkUsdUJBQ2hCdUUsRUFBZ0J0RSx3QkFFaEIvRixRQUFRQyxJQUFJLGNBQ1p1QyxTQUFTQyxlQUFlLGNBQWNRLFFBQVMsRyxJRHlINUMsSUFDRGlILEMsb1NDL0dOaEwsT0FBT3FMLE9BQVMsV0FDZE4sR0FDRixDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vTW9kb29Db2RlIEZyb250ZW50IEFwcC8uL3NyYy9sb2dpbi50cyIsIndlYnBhY2s6Ly9Nb2Rvb0NvZGUgRnJvbnRlbnQgQXBwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL01vZG9vQ29kZSBGcm9udGVudCBBcHAvLi9zcmMvY29tbWVudC50cyIsIndlYnBhY2s6Ly9Nb2Rvb0NvZGUgRnJvbnRlbnQgQXBwLy4vc3JjL3Njcm9sbC50cyIsIndlYnBhY2s6Ly9Nb2Rvb0NvZGUgRnJvbnRlbnQgQXBwLy4vc3JjL3V0aWwudHMiLCJ3ZWJwYWNrOi8vTW9kb29Db2RlIEZyb250ZW50IEFwcC8uL3NyYy90b2MudHMiLCJ3ZWJwYWNrOi8vTW9kb29Db2RlIEZyb250ZW50IEFwcC8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbnRlcmZhY2UgR29vZ2xlU2lnbkluUGFyYW1zIHtcbiAgY3JlZGVudGlhbDogc3RyaW5nO1xufVxuXG4od2luZG93IGFzIGFueSkub25Hb29nbGVMb2dpbiA9IChzaWduX2luOiBHb29nbGVTaWduSW5QYXJhbXMpID0+IHtcbiAgZmV0Y2goXCIvYXV0aC9nb29nXCIsIHtcbiAgICBtZXRob2Q6IFwicG9zdFwiLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIEFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICB9LFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIHRva2VuOiBzaWduX2luLmNyZWRlbnRpYWwsXG4gICAgfSksXG4gIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICB9KTtcbn07XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiZGVjbGFyZSBjb25zdCBncmVjYXB0Y2hhOiBhbnk7XG5cbmludGVyZmFjZSBDb21tZW50IHtcbiAgY29tbWVudF9pZDogbnVtYmVyO1xuICBhcnRpY2xlX3VybDogc3RyaW5nO1xuICByZXBseV9pZHM6IG51bWJlcltdO1xuICBjb21tZW50X2RhdGU6IHN0cmluZztcbiAgYXV0aG9yX25hbWU/OiBzdHJpbmc7XG4gIGltYWdlX2xpbms6IHN0cmluZztcbiAgY29udGVudDogc3RyaW5nO1xuICBpc19tZDogYm9vbGVhbjtcbn1cblxuaW50ZXJmYWNlIEdldENvbW1lbnRSZXNwb25zZSB7XG4gIGNvbW1lbnRzOiBDb21tZW50W107XG59XG5cbmNsYXNzIENvbW1lbnRNYW5hZ2VyIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5sYXN0X2NvbW1lbnRfaW5kZXhfID0gMDtcbiAgICB0aGlzLmNvbW1lbnRzXyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLnJvb3RfY29tbWVudHNfID0gW107XG5cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgdGhpcy5udW1fdG90YWxfY29tbWVudHNfID0gZ2V0TnVtVG90YWxDb21tZW50cygpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIExvYWRDb21tZW50cygpIHtcbiAgICBsZXQgdXJsID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lO1xuICAgIGxldCBhcnRpY2xlX3VybCA9IHVybC5zdWJzdHIodXJsLmxhc3RJbmRleE9mKFwiL1wiKSArIDEpO1xuXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXCIvZ2V0LWNvbW1lbnRcIiwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIG1vZGU6IFwiY29yc1wiLFxuICAgICAgY2FjaGU6IFwibm8tY2FjaGVcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhcnRpY2xlX3VybCxcbiAgICAgICAgaW5kZXhfc3RhcnQ6IHRoaXMubGFzdF9jb21tZW50X2luZGV4XyxcbiAgICAgIH0pLFxuICAgIH0pO1xuXG4gICAgbGV0IGdldF9jb21tZW50X3Jlc3BvbnNlOiBHZXRDb21tZW50UmVzcG9uc2UgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgbGV0IGNvbW1lbnRzID0gZ2V0X2NvbW1lbnRfcmVzcG9uc2UuY29tbWVudHM7XG4gICAgZm9yIChsZXQgY29tbWVudCBvZiBjb21tZW50cykge1xuICAgICAgdGhpcy5jb21tZW50c18uc2V0KGNvbW1lbnQuY29tbWVudF9pZCwgY29tbWVudCk7XG4gICAgfVxuXG4gICAgdGhpcy5sYXN0X2NvbW1lbnRfaW5kZXhfICs9IDUwO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIFBvc3RDb21tZW50KFxuICAgIHBhcmVudF9pZDogbnVtYmVyLFxuICAgIGNvbnRlbnQ6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nLFxuICAgIG5hbWU6IHN0cmluZ1xuICApIHtcbiAgICBjb25zdCB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICBsZXQgYXJ0aWNsZV91cmwgPSB1cmwuc3Vic3RyKHVybC5sYXN0SW5kZXhPZihcIi9cIikgKyAxKTtcblxuICAgIGNvbnN0IHBvc3RfZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicG9zdGVkLWNvbW1lbnRcIik7XG4gICAgZ3JlY2FwdGNoYS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICBncmVjYXB0Y2hhXG4gICAgICAgIC5leGVjdXRlKFwiNkxlRV9uWVVBQUFBQUdtOXFUYTcxSXd2dmF5V1Y5UTdmbHFOa3RvMlwiLCB7XG4gICAgICAgICAgYWN0aW9uOiBcIkNvbW1lbnRcIixcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRva2VuOiBzdHJpbmcpIHtcbiAgICAgICAgICBmZXRjaChcIi93cml0ZS1jb21tZW50XCIsIHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICBtb2RlOiBcImNvcnNcIixcbiAgICAgICAgICAgIGNhY2hlOiBcIm5vLWNhY2hlXCIsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgcGFyZW50X2lkOiBwYXJlbnRfaWQsXG4gICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQsXG4gICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCB8fCBcIlwiLFxuICAgICAgICAgICAgICBhdXRob3JfbmFtZTogbmFtZSxcbiAgICAgICAgICAgICAgYXJ0aWNsZV91cmw6IGFydGljbGVfdXJsLFxuICAgICAgICAgICAgICBjYXB0Y2hhX3Rva2VuOiB0b2tlbixcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhZGRpbmctY29tbWVudFwiKS5oaWRkZW4gPSB0cnVlO1xuICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgQ29tcHV0ZVJvb3RDb21tZW50cygpIHtcbiAgICBsZXQgY29tbWVudF9pZHMgPSBBcnJheS5mcm9tKHRoaXMuY29tbWVudHNfLmtleXMoKSkuc29ydCgoYSwgYikgPT4gYSAtIGIpO1xuICAgIGxldCB2aXNpdGVkX2NvbW1lbnRzID0gbmV3IFNldDxudW1iZXI+KCk7XG5cbiAgICB0aGlzLnJvb3RfY29tbWVudHNfID0gW107XG5cbiAgICAvLyBGaW5kIHRoZSByb290IGNvbW1lbnRzLlxuICAgIGZvciAobGV0IGNvbW1lbnRfaWQgb2YgY29tbWVudF9pZHMpIHtcbiAgICAgIGlmICh2aXNpdGVkX2NvbW1lbnRzLmhhcyhjb21tZW50X2lkKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5yb290X2NvbW1lbnRzXy5wdXNoKHRoaXMuY29tbWVudHNfLmdldChjb21tZW50X2lkKSEpO1xuICAgICAgdGhpcy5WaXNpdEFsbENoaWxkQ29tbWVudHMoY29tbWVudF9pZCwgdmlzaXRlZF9jb21tZW50cyk7XG4gICAgfVxuXG4gICAgdGhpcy5yb290X2NvbW1lbnRzXyA9IHRoaXMucm9vdF9jb21tZW50c18ucmV2ZXJzZSgpO1xuICB9XG5cbiAgVmlzaXRBbGxDaGlsZENvbW1lbnRzKGNvbW1lbnRfaWQ6IG51bWJlciwgdmlzaXRlZF9jb21tZW50czogU2V0PG51bWJlcj4pIHtcbiAgICBsZXQgY29tbWVudCA9IHRoaXMuY29tbWVudHNfLmdldChjb21tZW50X2lkKTtcbiAgICBpZiAoIWNvbW1lbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2aXNpdGVkX2NvbW1lbnRzLmFkZChjb21tZW50X2lkKTtcbiAgICBmb3IgKGxldCBjaGlsZF9jb21tZW50X2lkIG9mIGNvbW1lbnQucmVwbHlfaWRzIHx8IFtdKSB7XG4gICAgICB0aGlzLlZpc2l0QWxsQ2hpbGRDb21tZW50cyhjaGlsZF9jb21tZW50X2lkLCB2aXNpdGVkX2NvbW1lbnRzKTtcbiAgICB9XG5cbiAgICByZXR1cm47XG4gIH1cblxuICBDcmVhdGVDb21tZW50TGlzdCgpIHtcbiAgICBsZXQgcm9vdF9jb21tZW50X2xpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidWxcIik7XG4gICAgcm9vdF9jb21tZW50X2xpc3QuY2xhc3NMaXN0LmFkZChcImNvbW1lbnQtbGlzdFwiKTtcbiAgICByb290X2NvbW1lbnRfbGlzdC5pZCA9IFwicm9vdC1jb21tZW50LWxpc3RcIjtcblxuICAgIGZvciAoY29uc3QgY29tbWVudCBvZiB0aGlzLnJvb3RfY29tbWVudHNfKSB7XG4gICAgICBmb3IgKGNvbnN0IGNvbW1lbnRfZWxlbSBvZiB0aGlzLkNyZWF0ZUNvbW1lbnQoY29tbWVudC5jb21tZW50X2lkKSkge1xuICAgICAgICByb290X2NvbW1lbnRfbGlzdC5hcHBlbmRDaGlsZChjb21tZW50X2VsZW0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByb290X2NvbW1lbnRfbGlzdDtcbiAgfVxuXG4gIENyZWF0ZUNvbW1lbnQoY29tbWVudF9pZDogbnVtYmVyKSB7XG4gICAgbGV0IGNvbW1lbnQgPSB0aGlzLmNvbW1lbnRzXy5nZXQoY29tbWVudF9pZCk7XG4gICAgaWYgKCFjb21tZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGNvbW1lbnRfZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaVwiKTtcbiAgICBjb21tZW50X2VsZW0uY2xhc3NMaXN0LmFkZChcImNvbW1lbnRcIik7XG5cbiAgICBsZXQgY29tbWVudF9wcm9maWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb21tZW50X3Byb2ZpbGUuY2xhc3NMaXN0LmFkZChcImNvbW1lbnQtcHJvZmlsZVwiKTtcblxuICAgIGxldCBpbWFnZV9saW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcbiAgICBpZiAoY29tbWVudC5pbWFnZV9saW5rKSB7XG4gICAgICBpbWFnZV9saW5rLnNyYyA9IGNvbW1lbnQuaW1hZ2VfbGluaztcbiAgICAgIGltYWdlX2xpbmsuYWx0ID0gXCLtlITroZztlYQg7IKs7KeEXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGltYWdlX2xpbmsuc3JjID0gXCIuL2ltZy91bmtub3duX3BlcnNvbi5wbmdcIjtcbiAgICAgIGltYWdlX2xpbmsuYWx0ID0gXCLtlITroZztlYQg7IKs7KeEIOyXhuydjFwiO1xuICAgIH1cblxuICAgIGNvbW1lbnRfcHJvZmlsZS5hcHBlbmRDaGlsZChpbWFnZV9saW5rKTtcbiAgICBjb21tZW50X2VsZW0uYXBwZW5kQ2hpbGQoY29tbWVudF9wcm9maWxlKTtcblxuICAgIGxldCBjb21tZW50X2luZm8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbW1lbnRfaW5mby5jbGFzc0xpc3QuYWRkKFwiY29tbWVudC1pbmZvXCIpO1xuXG4gICAgLy8gQ29tbWVudCBoZWFkZXIuXG4gICAgbGV0IGNvbW1lbnRfaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb21tZW50X2hlYWRlci5jbGFzc0xpc3QuYWRkKFwiY29tbWVudC1oZWFkZXJcIik7XG5cbiAgICBsZXQgY3JlYXRlU2ltcGxlU3BhbiA9IChjbGFzc19uYW1lOiBzdHJpbmcsIHRleHQ6IHN0cmluZykgPT4ge1xuICAgICAgbGV0IGVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZChjbGFzc19uYW1lKTtcbiAgICAgIGVsZW0udGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgICAgcmV0dXJuIGVsZW07XG4gICAgfTtcblxuICAgIGNvbW1lbnRfaGVhZGVyLmFwcGVuZENoaWxkKFxuICAgICAgY3JlYXRlU2ltcGxlU3BhbihcImNvbW1lbnQtYXV0aG9yXCIsIGNvbW1lbnQuYXV0aG9yX25hbWUgfHwgXCJcIilcbiAgICApO1xuICAgIGNvbW1lbnRfaGVhZGVyLmFwcGVuZENoaWxkKFxuICAgICAgY3JlYXRlU2ltcGxlU3BhbihcImNvbW1lbnQtZGF0ZVwiLCBjb21tZW50LmNvbW1lbnRfZGF0ZSB8fCBcIlwiKVxuICAgICk7XG5cbiAgICBjb21tZW50X2luZm8uYXBwZW5kQ2hpbGQoY29tbWVudF9oZWFkZXIpO1xuXG4gICAgLy8gQ29tbWVudCBjb250ZW50LlxuICAgIGxldCBjb21tZW50X2NvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbW1lbnRfY29udGVudC5jbGFzc0xpc3QuYWRkKFwiY29tbWVudC1jb250ZW50XCIpO1xuICAgIGNvbW1lbnRfY29udGVudC50ZXh0Q29udGVudCA9IGNvbW1lbnQuY29udGVudDtcbiAgICBjb21tZW50X2luZm8uYXBwZW5kQ2hpbGQoY29tbWVudF9jb250ZW50KTtcblxuICAgIGxldCBjb21tZW50X2FjdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29tbWVudF9hY3Rpb24uY2xhc3NMaXN0LmFkZChcImNvbW1lbnQtYWN0aW9uXCIpO1xuICAgIGNvbW1lbnRfYWN0aW9uLmlkID0gXCJjb21tZW50LWlkLVwiICsgY29tbWVudF9pZDtcblxuICAgIGNvbW1lbnRfYWN0aW9uLmFwcGVuZENoaWxkKGNyZWF0ZVNpbXBsZVNwYW4oXCJjb21tZW50LXVwdm90ZVwiLCBcIuy2lOyynFwiKSk7XG4gICAgY29tbWVudF9hY3Rpb24uYXBwZW5kQ2hpbGQoY3JlYXRlU2ltcGxlU3BhbihcImNvbW1lbnQtcmVwbHlcIiwgXCLri7XquIBcIikpO1xuICAgIGNvbW1lbnRfYWN0aW9uLmFwcGVuZENoaWxkKGNyZWF0ZVNpbXBsZVNwYW4oXCJjb21tZW50LWRlbGV0ZVwiLCBcIuuLteq4gCDsgq3soJxcIikpO1xuICAgIGNvbW1lbnRfaW5mby5hcHBlbmRDaGlsZChjb21tZW50X2FjdGlvbik7XG5cbiAgICBjb21tZW50X2VsZW0uYXBwZW5kQ2hpbGQoY29tbWVudF9pbmZvKTtcblxuICAgIGlmICghY29tbWVudC5yZXBseV9pZHM/Lmxlbmd0aCkge1xuICAgICAgcmV0dXJuIFtjb21tZW50X2VsZW1dO1xuICAgIH1cblxuICAgIGxldCBjaGlsZF9jb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ1bFwiKTtcbiAgICBjaGlsZF9jb21tZW50cy5jbGFzc0xpc3QuYWRkKFwiY29tbWVudC1saXN0XCIpO1xuXG4gICAgZm9yIChjb25zdCByZXBseV9pZCBvZiBjb21tZW50LnJlcGx5X2lkcykge1xuICAgICAgbGV0IGVsZW1zID0gdGhpcy5DcmVhdGVDb21tZW50KHJlcGx5X2lkKTtcbiAgICAgIGZvciAoY29uc3QgZWxlbSBvZiBlbGVtcykge1xuICAgICAgICBjaGlsZF9jb21tZW50cy5hcHBlbmQoZWxlbSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIFtjb21tZW50X2VsZW0sIGNoaWxkX2NvbW1lbnRzXTtcbiAgfVxuXG4gIEdldE51bVRvdGFsQ29tbWVudHMoKSB7XG4gICAgcmV0dXJuIHRoaXMubnVtX3RvdGFsX2NvbW1lbnRzXztcbiAgfVxuXG4gIEdldExhc3RDb21tZW50SW5kZXgoKSB7XG4gICAgcmV0dXJuIHRoaXMubGFzdF9jb21tZW50X2luZGV4XztcbiAgfVxuXG4gIHByaXZhdGUgbGFzdF9jb21tZW50X2luZGV4XzogbnVtYmVyO1xuICBwcml2YXRlIGNvbW1lbnRzXzogTWFwPG51bWJlciwgQ29tbWVudD47XG4gIHByaXZhdGUgcm9vdF9jb21tZW50c186IENvbW1lbnRbXTtcbiAgcHJpdmF0ZSBudW1fdG90YWxfY29tbWVudHNfOiBudW1iZXI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBDcmVhdGVDb21tZW50TWFuYWdlcigpOiBDb21tZW50TWFuYWdlciB7XG4gIGxldCBjb21tZW50ID0gbmV3IENvbW1lbnRNYW5hZ2VyKCk7XG4gIHJldHVybiBjb21tZW50O1xufVxuIiwiY2xhc3MgU2Nyb2xsIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMubGFzdF9wb3NpdGlvbiA9IHdpbmRvdy5zY3JvbGxZO1xuICAgIHRoaXMudGltZV90b191cGRhdGVfdG9jID0gdHJ1ZTtcblxuICAgIHRoaXMuc2Nyb2xsX2Rvd25fZXZlbnRfaGFuZGxlcnMgPSBbXTtcbiAgICB0aGlzLnNjcm9sbF91cF9ldmVudF9oYW5kbGVycyA9IFtdO1xuXG4gICAgdGhpcy5JbnN0YWxsU2Nyb2xsRXZlbnRIYW5kbGVyKCk7XG4gIH1cblxuICBwcml2YXRlIEluc3RhbGxTY3JvbGxFdmVudEhhbmRsZXIoKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIChlKSA9PiB7XG4gICAgICBpZiAodGhpcy50aW1lX3RvX3VwZGF0ZV90b2MpIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgICAgdGhpcy50aW1lX3RvX3VwZGF0ZV90b2MgPSB0cnVlO1xuICAgICAgICAgIGlmICh0aGlzLmxhc3RfcG9zaXRpb24gPiB3aW5kb3cuc2Nyb2xsWSkge1xuICAgICAgICAgICAgZm9yIChsZXQgZnVuYyBvZiB0aGlzLnNjcm9sbF91cF9ldmVudF9oYW5kbGVycykge1xuICAgICAgICAgICAgICBmdW5jKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAobGV0IGZ1bmMgb2YgdGhpcy5zY3JvbGxfZG93bl9ldmVudF9oYW5kbGVycykge1xuICAgICAgICAgICAgICBmdW5jKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMubGFzdF9wb3NpdGlvbiA9IHdpbmRvdy5zY3JvbGxZO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50aW1lX3RvX3VwZGF0ZV90b2MgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBSZWdpc3RlclNjcm9sbFVwSGFuZGxlcihmdW5jOiAoKT0+dm9pZCkge1xuICAgIHRoaXMuc2Nyb2xsX3VwX2V2ZW50X2hhbmRsZXJzLnB1c2goZnVuYyk7XG4gIH1cblxuICBwdWJsaWMgUmVnaXN0ZXJTY3JvbGxEb3duSGFuZGxlcihmdW5jOiAoKT0+dm9pZCkge1xuICAgIHRoaXMuc2Nyb2xsX2Rvd25fZXZlbnRfaGFuZGxlcnMucHVzaChmdW5jKTtcbiAgfVxuXG4gIHByaXZhdGUgbGFzdF9wb3NpdGlvbjogbnVtYmVyO1xuXG4gIC8vIE1ha2Ugc3VyZSBub3QgdG8gaGFuZGxlIHNjcm9sbCBldmVudCB0b28gb2Z0ZW4uXG4gIHByaXZhdGUgdGltZV90b191cGRhdGVfdG9jOiBib29sZWFuO1xuXG4gIHByaXZhdGUgc2Nyb2xsX2Rvd25fZXZlbnRfaGFuZGxlcnM6ICgoKT0+IHZvaWQpW107XG4gIHByaXZhdGUgc2Nyb2xsX3VwX2V2ZW50X2hhbmRsZXJzOiAoKCk9PiB2b2lkKVtdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gQ3JlYXRlU2Nyb2xsSGFuZGxlcigpIDogU2Nyb2xsIHtcbiAgbGV0IHNjcm9sbCA9IG5ldyBTY3JvbGwoKTtcbiAgcmV0dXJuIHNjcm9sbDtcbn1cbiIsImV4cG9ydCBmdW5jdGlvbiBTdHJpcFByZWZpeE5ic3Aoc3RyOiBzdHJpbmcpOiBzdHJpbmcge1xuICBsZXQgaSA9IDA7XG4gIGZvciAoOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHN0cltpXSA9PSAnwqAnKSB7ICAvLyBUaGlzIGlzIG5vdCBzcGFjZS4gVGhpcyBpcyB1bmljb2RlIE5CU1AgKFUrMDBBMClcbiAgICAgIGNvbnRpbnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoaSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBHZXRIZWFkZXJOdW0oc3RyOiBzdHJpbmcpOiBudW1iZXIge1xuICBpZiAoIShzdHJbMF0gPT0gJ2gnIHx8IHN0clswXSA9PSAnSCcpKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9XG5cbiAgcmV0dXJuIHBhcnNlSW50KHN0ci5zdWJzdHJpbmcoMSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gSXNFbGVtZW50SW5WaWV3UG9ydChlbDogSFRNTEVsZW1lbnQpOiBib29sZWFuIHtcbiAgbGV0IGJvdW5kaW5nID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIHJldHVybiBib3VuZGluZy50b3AgPj0gMCAmJiBib3VuZGluZy5sZWZ0ID49IDAgJiZcbiAgICAgIGJvdW5kaW5nLnJpZ2h0IDw9XG4gICAgICAod2luZG93LmlubmVyV2lkdGggfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoKSAmJlxuICAgICAgYm91bmRpbmcuYm90dG9tIDw9XG4gICAgICAod2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpO1xufSIsImltcG9ydCAqIGFzIFV0aWwgZnJvbSAnLi91dGlsJztcblxuaW50ZXJmYWNlIFRPQ0hlYWRlciB7XG4gIGhlYWRlcl9uYW1lOiBzdHJpbmc7XG4gIGhlYWRlcl90YWc6IG51bWJlcjtcbiAgaGVhZGVyX2lkOiBzdHJpbmc7XG4gIGhlYWRlcl9wb3M6IG51bWJlcjtcbiAgaGVhZGVyX2VsZW1fbGluazogSFRNTEFuY2hvckVsZW1lbnQ7XG59XG5cbmNsYXNzIFRPQyB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMudG9jX2hlYWRlcnNfID0gW107XG4gICAgdGhpcy50aW1lX3RvX3VwZGF0ZV90b2MgPSB0cnVlO1xuICAgIHRoaXMucHJldl9oaWdobGlnaHRlZCA9IDA7XG5cbiAgICAvLyBGZXRjaCBUT0MgSGVhZGVycy5cbiAgICB0aGlzLkZldGNoSGVhZGVycygpO1xuICB9XG5cbiAgcHJpdmF0ZSBGZXRjaEhlYWRlcnMoKSB7XG4gICAgLy8gRmlyc3QgaWRlbnRpZnkgYWxsIHRoZSBoZWFkZXJzLlxuICAgIGxldCBoZWFkZXJzOiBOb2RlTGlzdE9mPEVsZW1lbnQ+ID1cbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmhlYWRlci1nZW5lcmFsJyk7XG5cbiAgICBmb3IgKGxldCBoZWFkZXIgb2YgaGVhZGVycyBhcyBhbnkpIHtcbiAgICAgIGxldCBoZWFkZXJfbmFtZTogc3RyaW5nID0gVXRpbC5TdHJpcFByZWZpeE5ic3AoaGVhZGVyLmlubmVyVGV4dCk7XG4gICAgICBsZXQgaGVhZGVyX3RhZzogbnVtYmVyID0gVXRpbC5HZXRIZWFkZXJOdW0oaGVhZGVyLnRhZ05hbWUpO1xuICAgICAgbGV0IGhlYWRlcl9pZDogc3RyaW5nID0gaGVhZGVyLmlkO1xuICAgICAgbGV0IGhlYWRlcl9wb3M6IG51bWJlciA9XG4gICAgICAgICAgaGVhZGVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCArIHdpbmRvdy5zY3JvbGxZO1xuICAgICAgdGhpcy50b2NfaGVhZGVyc18ucHVzaCh7XG4gICAgICAgIGhlYWRlcl9uYW1lLFxuICAgICAgICBoZWFkZXJfdGFnLFxuICAgICAgICBoZWFkZXJfaWQsXG4gICAgICAgIGhlYWRlcl9wb3MsXG4gICAgICAgIGhlYWRlcl9lbGVtX2xpbms6IG51bGxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgUmVjdXJzaXZlVE9DQ3JlYXRvcihcbiAgICAgIHBhcmVudF9vbDogSFRNTE9MaXN0RWxlbWVudCwgY3VycmVudF9oZWFkZXJfbnVtOiBudW1iZXIsXG4gICAgICB0YWdfbnVtYmVyOiBudW1iZXIpIHtcbiAgICBsZXQgY3VycmVudF9saSA9IG51bGw7XG4gICAgbGV0IGkgPSBjdXJyZW50X2hlYWRlcl9udW07XG4gICAgZm9yICg7IGkgPCB0aGlzLnRvY19oZWFkZXJzXy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IGhlYWRlciA9IHRoaXMudG9jX2hlYWRlcnNfW2ldO1xuXG4gICAgICAvLyBoMyAtPiBoMlxuICAgICAgaWYgKGhlYWRlci5oZWFkZXJfdGFnIDwgdGFnX251bWJlcikge1xuICAgICAgICByZXR1cm4gaTtcbiAgICAgIH1cbiAgICAgIC8vIGgyIC0+IGgzXG4gICAgICBlbHNlIGlmIChoZWFkZXIuaGVhZGVyX3RhZyA+IHRhZ19udW1iZXIpIHtcbiAgICAgICAgbGV0IGNoaWxkX3BhcmVudF9vbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29sJykgYXMgSFRNTE9MaXN0RWxlbWVudDtcbiAgICAgICAgY2hpbGRfcGFyZW50X29sLmNsYXNzTmFtZSA9ICd0b2MtbGlzdCc7XG4gICAgICAgIGN1cnJlbnRfbGkuYXBwZW5kQ2hpbGQoY2hpbGRfcGFyZW50X29sKTtcbiAgICAgICAgaSA9IHRoaXMuUmVjdXJzaXZlVE9DQ3JlYXRvcihjaGlsZF9wYXJlbnRfb2wsIGksIGhlYWRlci5oZWFkZXJfdGFnKTtcbiAgICAgICAgaS0tO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGVsZW1lbnQgPSBCdWlsZENhdGVnb3J5TGlzdEVsZW1lbnQoaGVhZGVyKTtcbiAgICAgICAgaGVhZGVyLmhlYWRlcl9lbGVtX2xpbmsgPSBlbGVtZW50LmZpcnN0Q2hpbGQgYXMgSFRNTEFuY2hvckVsZW1lbnQ7XG4gICAgICAgIHBhcmVudF9vbC5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgICAgY3VycmVudF9saSA9IGVsZW1lbnQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpO1xuICB9XG5cbiAgcHVibGljIENyZWF0ZVRPQ0xpc3QoKSB7XG4gICAgbGV0IHJvb3Rfb2wgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudG9jLWxpc3QnKSBhcyBIVE1MT0xpc3RFbGVtZW50O1xuICAgIGlmIChyb290X29sID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5SZWN1cnNpdmVUT0NDcmVhdG9yKHJvb3Rfb2wsIDAsIHRoaXMudG9jX2hlYWRlcnNfWzBdLmhlYWRlcl90YWcpO1xuXG4gICAgdGhpcy5JbnN0YWxsVE9DRXZlbnRIYW5kbGVycygpO1xuICB9XG5cbiAgcHJpdmF0ZSBJbnN0YWxsVE9DRXZlbnRIYW5kbGVycygpIHtcbiAgICBsZXQgdGhhdCA9IHRoaXM7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xuICAgICAgbGV0IGxhc3Rfa25vd25fc2Nyb2xsX3BvcyA9IHdpbmRvdy5zY3JvbGxZO1xuICAgICAgaWYgKHRoYXQudGltZV90b191cGRhdGVfdG9jKSB7XG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdGhhdC50aW1lX3RvX3VwZGF0ZV90b2MgPSB0cnVlO1xuICAgICAgICAgIGxldCBoZWFkZXJfbnVtID0gdGhhdC5HZXRDdXJyZW50QWN0aXZlVE9DSXRlbShsYXN0X2tub3duX3Njcm9sbF9wb3MpO1xuICAgICAgICAgIHRoYXQuSGlnaGxpZ2h0QWN0aXZlSXRlbShoZWFkZXJfbnVtKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoYXQudGltZV90b191cGRhdGVfdG9jID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIHByaXZhdGUgSGlnaGxpZ2h0QWN0aXZlSXRlbShpdGVtX251bTogbnVtYmVyKSB7XG4gICAgdGhpcy50b2NfaGVhZGVyc19bdGhpcy5wcmV2X2hpZ2hsaWdodGVkXS5oZWFkZXJfZWxlbV9saW5rLmNsYXNzTmFtZSA9XG4gICAgICAgICd0b2MtaXRlbS1saW5rJztcbiAgICB0aGlzLnRvY19oZWFkZXJzX1tpdGVtX251bV0uaGVhZGVyX2VsZW1fbGluay5jbGFzc05hbWUgPVxuICAgICAgICAndG9jLWl0ZW0tbGluayB0b2MtYWN0aXZlLWl0ZW0nO1xuICAgIHRoaXMucHJldl9oaWdobGlnaHRlZCA9IGl0ZW1fbnVtO1xuICB9XG5cbiAgcHVibGljIEluc3RhbGxMaW5rQ2xpY2tIYW5kbGVyKCkge1xuICAgIGZvciAobGV0IGhlYWRlciBvZiB0aGlzLnRvY19oZWFkZXJzXykge1xuICAgICAgaGVhZGVyLmhlYWRlcl9lbGVtX2xpbmsub25jbGljayA9IChlOiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCBoZWFkZXIuaGVhZGVyX3BvcyAtIDE1MCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGhlYWRlci5oZWFkZXJfcG9zIC0gMTUwKTtcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBHZXRDdXJyZW50QWN0aXZlVE9DSXRlbShzY3JvbGxfcG9zOiBudW1iZXIpIHtcbiAgICBpZiAoc2Nyb2xsX3BvcyA8IHRoaXMudG9jX2hlYWRlcnNfWzBdLmhlYWRlcl9wb3MpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIGxldCBpID0gMDtcbiAgICBmb3IgKDsgaSA8IHRoaXMudG9jX2hlYWRlcnNfLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoaSA9PSB0aGlzLnRvY19oZWFkZXJzXy5sZW5ndGggLSAxKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICB0aGlzLnRvY19oZWFkZXJzX1tpXS5oZWFkZXJfcG9zIDw9IHNjcm9sbF9wb3MgJiZcbiAgICAgICAgICBzY3JvbGxfcG9zIDwgdGhpcy50b2NfaGVhZGVyc19baSArIDFdLmhlYWRlcl9wb3MpIHtcbiAgICAgICAgaWYgKHNjcm9sbF9wb3MgLSB0aGlzLnRvY19oZWFkZXJzX1tpXS5oZWFkZXJfcG9zID5cbiAgICAgICAgICAgICAgICB0aGlzLnRvY19oZWFkZXJzX1tpICsgMV0uaGVhZGVyX3BvcyAtIHNjcm9sbF9wb3MgJiZcbiAgICAgICAgICAgIFV0aWwuSXNFbGVtZW50SW5WaWV3UG9ydChcbiAgICAgICAgICAgICAgICB0aGlzLnRvY19oZWFkZXJzX1tpICsgMV0uaGVhZGVyX2VsZW1fbGluaykpIHtcbiAgICAgICAgICByZXR1cm4gaSArIDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGk7XG4gIH1cblxuICBwcml2YXRlIHRvY19oZWFkZXJzXzogVE9DSGVhZGVyW107XG4gIHByaXZhdGUgdGltZV90b191cGRhdGVfdG9jOiBib29sZWFuO1xuICBwcml2YXRlIHByZXZfaGlnaGxpZ2h0ZWQ6IG51bWJlcjtcbn1cblxuZnVuY3Rpb24gQnVpbGRDYXRlZ29yeUxpc3RFbGVtZW50KGhlYWRlcjogVE9DSGVhZGVyKTogSFRNTExJRWxlbWVudCB7XG4gIGxldCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKSBhcyBIVE1MTElFbGVtZW50O1xuICBlbGVtZW50LmNsYXNzTmFtZSA9ICd0b2MtbGlzdC1pdGVtJztcblxuICBsZXQgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKSBhcyBIVE1MU3BhbkVsZW1lbnQ7XG4gIGxpbmsuY2xhc3NOYW1lID0gJ3RvYy1pdGVtLWxpbmsnXG4gIGxpbmsudGV4dENvbnRlbnQgPSBoZWFkZXIuaGVhZGVyX25hbWU7XG5cbiAgZWxlbWVudC5hcHBlbmRDaGlsZChsaW5rKTtcbiAgcmV0dXJuIGVsZW1lbnQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBCdWlsZFRhYmxlT2ZDb250ZW50cygpOiBUT0Mge1xuICBsZXQgdG9jID0gbmV3IFRPQygpO1xuICB0b2MuQ3JlYXRlVE9DTGlzdCgpO1xuXG4gIC8vIEluc3RhbGwgY2xpY2sgaGFuZGxlcnMuXG4gIHRvYy5JbnN0YWxsTGlua0NsaWNrSGFuZGxlcigpO1xuICByZXR1cm4gdG9jO1xufVxuIiwiaW1wb3J0IHsgQ3JlYXRlQ29tbWVudE1hbmFnZXIgfSBmcm9tIFwiLi9jb21tZW50XCI7XG5pbXBvcnQgKiBhcyBTY3JvbGwgZnJvbSBcIi4vc2Nyb2xsXCI7XG5pbXBvcnQgKiBhcyBUT0MgZnJvbSBcIi4vdG9jXCI7XG5pbXBvcnQgXCIuL2xvZ2luXCI7XG5cbi8vIE1haW4gZW50cnkgcG9pbnQuXG5hc3luYyBmdW5jdGlvbiBNYWluKCkge1xuICBUT0MuQnVpbGRUYWJsZU9mQ29udGVudHMoKTtcblxuICBsZXQgc2Nyb2xsID0gU2Nyb2xsLkNyZWF0ZVNjcm9sbEhhbmRsZXIoKTtcbiAgc2Nyb2xsLlJlZ2lzdGVyU2Nyb2xsVXBIYW5kbGVyKCgpID0+IHtcbiAgICAvKlxuICAgIGNvbnNvbGUubG9nKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCI6dGFyZ2V0XCIpKTtcbiAgICBsZXQgcGFkZGVkX2hlYWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCI6dGFyZ2V0XCIpIGFzIEhUTUxBbmNob3JFbGVtZW50O1xuICAgIGlmIChwYWRkZWRfaGVhZGVyLnN0eWxlLnBhZGRpbmdUb3AgIT0gXCIwXCIpIHtcbiAgICAgIHBhZGRlZF9oZWFkZXIuc3R5bGUucGFkZGluZ1RvcCA9IFwiMFwiO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSAjIGZyb20gdXJsLlxuICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKG51bGwsIG51bGwsICcgJyk7Ki9cbiAgfSk7XG5cbiAgbGV0IGNvbW1lbnRfbWFuYWdlciA9IENyZWF0ZUNvbW1lbnRNYW5hZ2VyKCk7XG4gIGF3YWl0IGNvbW1lbnRfbWFuYWdlci5Mb2FkQ29tbWVudHMoKTtcblxuICBjb21tZW50X21hbmFnZXIuQ29tcHV0ZVJvb3RDb21tZW50cygpO1xuICBjb25zb2xlLmxvZyhcImh0bWwgXCIsIGNvbW1lbnRfbWFuYWdlci5DcmVhdGVDb21tZW50TGlzdCgpKTtcblxuICBpZiAoXG4gICAgY29tbWVudF9tYW5hZ2VyLkdldE51bVRvdGFsQ29tbWVudHMoKSA+PVxuICAgIGNvbW1lbnRfbWFuYWdlci5HZXRMYXN0Q29tbWVudEluZGV4KClcbiAgKSB7XG4gICAgY29uc29sZS5sb2coXCJub3QgaGlkZGVuXCIpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYnV0dG9uLWJveFwiKS5oaWRkZW4gPSBmYWxzZTtcbiAgfVxuXG4gIC8qXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29tbWVudC1saXN0LXNlY3Rpb25cIikuaW5uZXJIVE1MID0gY29tbWVudF9tYW5hZ2VyXG4gICAgLkNyZWF0ZUNvbW1lbnRMaXN0KClcbiAgICAubWFwKChlKSA9PiBlLm91dGVySFRNTClcbiAgICAuam9pbihcIlwiKTtcbiAgICAqL1xufVxuXG53aW5kb3cub25sb2FkID0gKCkgPT4ge1xuICBNYWluKCk7XG59O1xuIl0sIm5hbWVzIjpbIndpbmRvdyIsIm9uR29vZ2xlTG9naW4iLCJzaWduX2luIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiQWNjZXB0IiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0b2tlbiIsImNyZWRlbnRpYWwiLCJ0aGVuIiwicmVzcG9uc2UiLCJjb25zb2xlIiwibG9nIiwibG9jYXRpb24iLCJyZWxvYWQiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsInRoaXMiLCJsYXN0X2NvbW1lbnRfaW5kZXhfIiwiY29tbWVudHNfIiwiTWFwIiwicm9vdF9jb21tZW50c18iLCJudW1fdG90YWxfY29tbWVudHNfIiwiZ2V0TnVtVG90YWxDb21tZW50cyIsIkxvYWRDb21tZW50cyIsInVybCIsInBhdGhuYW1lIiwiYXJ0aWNsZV91cmwiLCJzdWJzdHIiLCJsYXN0SW5kZXhPZiIsIm1vZGUiLCJjYWNoZSIsImluZGV4X3N0YXJ0IiwianNvbiIsImdldF9jb21tZW50X3Jlc3BvbnNlIiwiY29tbWVudHMiLCJjb21tZW50Iiwic2V0IiwiY29tbWVudF9pZCIsIlBvc3RDb21tZW50IiwicGFyZW50X2lkIiwiY29udGVudCIsInBhc3N3b3JkIiwibmFtZSIsImhyZWYiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ3JlY2FwdGNoYSIsInJlYWR5IiwiZXhlY3V0ZSIsImFjdGlvbiIsImF1dGhvcl9uYW1lIiwiY2FwdGNoYV90b2tlbiIsImRhdGEiLCJoaWRkZW4iLCJDb21wdXRlUm9vdENvbW1lbnRzIiwiY29tbWVudF9pZHMiLCJBcnJheSIsImZyb20iLCJrZXlzIiwic29ydCIsImEiLCJiIiwidmlzaXRlZF9jb21tZW50cyIsIlNldCIsImhhcyIsInB1c2giLCJnZXQiLCJWaXNpdEFsbENoaWxkQ29tbWVudHMiLCJyZXZlcnNlIiwiYWRkIiwicmVwbHlfaWRzIiwiY2hpbGRfY29tbWVudF9pZCIsIkNyZWF0ZUNvbW1lbnRMaXN0Iiwicm9vdF9jb21tZW50X2xpc3QiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiaWQiLCJDcmVhdGVDb21tZW50IiwiY29tbWVudF9lbGVtIiwiYXBwZW5kQ2hpbGQiLCJjb21tZW50X3Byb2ZpbGUiLCJpbWFnZV9saW5rIiwic3JjIiwiYWx0IiwiY29tbWVudF9pbmZvIiwiY29tbWVudF9oZWFkZXIiLCJjcmVhdGVTaW1wbGVTcGFuIiwiY2xhc3NfbmFtZSIsInRleHQiLCJlbGVtIiwidGV4dENvbnRlbnQiLCJjb21tZW50X2RhdGUiLCJjb21tZW50X2NvbnRlbnQiLCJjb21tZW50X2FjdGlvbiIsImxlbmd0aCIsImNoaWxkX2NvbW1lbnRzIiwicmVwbHlfaWQiLCJhcHBlbmQiLCJHZXROdW1Ub3RhbENvbW1lbnRzIiwiR2V0TGFzdENvbW1lbnRJbmRleCIsImxhc3RfcG9zaXRpb24iLCJzY3JvbGxZIiwidGltZV90b191cGRhdGVfdG9jIiwic2Nyb2xsX2Rvd25fZXZlbnRfaGFuZGxlcnMiLCJzY3JvbGxfdXBfZXZlbnRfaGFuZGxlcnMiLCJJbnN0YWxsU2Nyb2xsRXZlbnRIYW5kbGVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJmdW5jIiwiUmVnaXN0ZXJTY3JvbGxVcEhhbmRsZXIiLCJSZWdpc3RlclNjcm9sbERvd25IYW5kbGVyIiwiU3RyaXBQcmVmaXhOYnNwIiwic3RyIiwiaSIsInN1YnN0cmluZyIsInRvY19oZWFkZXJzXyIsInByZXZfaGlnaGxpZ2h0ZWQiLCJGZXRjaEhlYWRlcnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiaGVhZGVyIiwiaGVhZGVyX25hbWUiLCJpbm5lclRleHQiLCJoZWFkZXJfdGFnIiwidGFnTmFtZSIsInBhcnNlSW50IiwiaGVhZGVyX2lkIiwiaGVhZGVyX3BvcyIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsImhlYWRlcl9lbGVtX2xpbmsiLCJSZWN1cnNpdmVUT0NDcmVhdG9yIiwicGFyZW50X29sIiwiY3VycmVudF9oZWFkZXJfbnVtIiwidGFnX251bWJlciIsImN1cnJlbnRfbGkiLCJjaGlsZF9wYXJlbnRfb2wiLCJjbGFzc05hbWUiLCJlbGVtZW50IiwiQnVpbGRDYXRlZ29yeUxpc3RFbGVtZW50IiwiZmlyc3RDaGlsZCIsIkNyZWF0ZVRPQ0xpc3QiLCJyb290X29sIiwicXVlcnlTZWxlY3RvciIsIkluc3RhbGxUT0NFdmVudEhhbmRsZXJzIiwidGhhdCIsImxhc3Rfa25vd25fc2Nyb2xsX3BvcyIsImhlYWRlcl9udW0iLCJHZXRDdXJyZW50QWN0aXZlVE9DSXRlbSIsIkhpZ2hsaWdodEFjdGl2ZUl0ZW0iLCJpdGVtX251bSIsIkluc3RhbGxMaW5rQ2xpY2tIYW5kbGVyIiwib25jbGljayIsInNjcm9sbFRvIiwic2Nyb2xsX3BvcyIsImJvdW5kaW5nIiwibGVmdCIsInJpZ2h0IiwiaW5uZXJXaWR0aCIsImRvY3VtZW50RWxlbWVudCIsImNsaWVudFdpZHRoIiwiYm90dG9tIiwiaW5uZXJIZWlnaHQiLCJjbGllbnRIZWlnaHQiLCJsaW5rIiwiTWFpbiIsInRvYyIsIlRPQyIsIlNjcm9sbCIsImNvbW1lbnRfbWFuYWdlciIsIkNvbW1lbnRNYW5hZ2VyIiwib25sb2FkIl0sInNvdXJjZVJvb3QiOiIifQ==